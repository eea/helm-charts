version: '2'
volumes:
  webforms_eionet_mysql:
    external: true
    driver: netapp
  webforms-eionet-config:
    external: true
    driver: rancher-nfs
services:
  appl:
    mem_limit: 3355443200
    image: eeacms/webq2:2022-05-24T1320
    environment:
      CATALINA_OPTS: '"-Dcas.service=https://webforms.eionet.europa.eu" "-Dlog4j.configuration=file:/opt/config/log4j.xml"
        "-Djava.security.egd=file:/dev/./urandom" "-Ddb.url=jdbc:mysql://webqproddb:3306/webq2?maxAllowedPacket=32212254720"
        "-Ddb.driver=com.mysql.jdbc.Driver" "-Ddb.username=webqapp" "-Ddb.password=dasijeqo"
        "-Dconverters.api.url=https://converters.eionet.europa.eu/api/" "-Duser.file.expiration.hours=72"'
      JAVA_OPTS: '"-Xmx3072m"'
    volumes:
    - webforms-eionet-config:/opt/config
    mem_reservation: 3145728000
    links:
    - webqproddb:webqproddb

  webqproddb:
    mem_limit: 1073741824
    image: mariadb:10.1.26
    environment:
      MYSQL_DATABASE: webq2
      MYSQL_PASSWORD: dasijeqo
      MYSQL_ROOT_PASSWORD: sonarocovo
      MYSQL_USER: webqapp
    volumes:
    - webforms_eionet_mysql:/var/lib/mysql
    mem_reservation: 838860800
    command:
    - mysqld
    - --max_allowed_packet=30M
    - --innodb_log_file_size=152MB
