---
# Source: sdi-catalogue/charts/postfix/templates/postfix-netsecpol.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: postfix
  labels:
    helm.sh/chart: postfix-3.2.0
    app.kubernetes.io/name: postfix
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "3.5-1.2"
    app.kubernetes.io/managed-by: Helm

spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: postfix
      app.kubernetes.io/instance: release-name

  policyTypes:
  - Ingress


  ingress:
  - from:
    - podSelector: {}

    ports:
    - protocol: TCP
      port: 25
---
# Source: sdi-catalogue/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-sdi-catalogue
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
---
# Source: sdi-catalogue/templates/tls-certificate.yaml
apiVersion: v1
kind: Secret
metadata:
  name: dummy-certificate
type: kubernetes.io/tls
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM3RENDQWRTZ0F3SUJBZ0lSQU1nOW1kQm1BWVpvVFBlei85Q3Q5Tll3RFFZSktvWklodmNOQVFFTEJRQXcKRVRFUE1BMEdBMVVFQXhNR1lYQmhZMmhsTUI0WERUSTJNREV5TnpFek1UQXlNbG9YRFRNMk1ERXlOVEV6TVRBeQpNbG93RVRFUE1BMEdBMVVFQXhNR1lYQmhZMmhsTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCCkNnS0NBUUVBdERjMGRmQlZ1emVlNXl3YkNJaXZLbVA3Q0V1a2VjcEErM09iRVNoc012WGFxS0s4c1BtTlFMUTgKUTRFelo1N3dVazB0YktScWJMMTN1bUIydUlwMkljWjBmMitFMjJtVDdPYWxpdW5OcFZadVZqOXowM0pDOG84Nwp4TFh0K3k3YmZ0YU9vcFY3akZ2aEVvV0lLbHEyeGc4RVowK1QzU1M2K0l6Yityckc5SWxKcXVVK3dKZnNVNUs2CkZIZ2tNUk01NkJvSTNCYUFZT0IvYmhLSWJEQ1N1UDRRd0ZHMkg4Umk3ekxoNXZNNUN6bGphNmxSbURHRHFCbGgKRDdXTlJERjhJTE53SUxhWGxPKzZ4OWVFUFJ2YkpTNzNCejNxOUtGdkVvQXcrK1ZPTVJNM2YwdVJiRkN6aUNkago1Sy8yMEtkRk5FRzlobyt0OXBhdndlMi9QeFU5TndJREFRQUJvejh3UFRBT0JnTlZIUThCQWY4RUJBTUNCYUF3CkhRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQXdHQTFVZEV3RUIvd1FDTUFBd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBQnI1eUhnbUxLQWxpSEU1RkpScStkaHU0YXV2TzBwTVA2eDlEV0wyMVRZawpnempsTllJTS92LzQ0TjZVUldnOUFPQ21TR2ozSFBBT0lwK3ZZczBUWkxvenVySnZoU1E3M0xHcVkxWThhT0xwCnZvZDF1d0lsU3dLdk9odTNLbnhJMUlPTlJWWEJ0ZmxxNmNwbUpOdXlUeUJxZktraStRdVhwYWM5VUFtQ3l4ZEIKQzkydHlkd0E5bEVJR2Q5SzArdStWenJ0WnY0VFNDUTQreWNyMlVtV2JNeFJjTkRWZ3B2TG1lRWJNeDhWVlRKTQoxYUh2dGNKVXVTUG95QjZkUmU4ZVByOS9rTFpxbmR2WW1ZOW9BcEZoTTMrU3VYcWI4a011dFhoR1FRcG13OE0wCjREVEFZaFZaU0dFSTlBMGNyVVNENWh6enZGNjJzcVVmclAzbVZkL3g1dG89Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdERjMGRmQlZ1emVlNXl3YkNJaXZLbVA3Q0V1a2VjcEErM09iRVNoc012WGFxS0s4CnNQbU5RTFE4UTRFelo1N3dVazB0YktScWJMMTN1bUIydUlwMkljWjBmMitFMjJtVDdPYWxpdW5OcFZadVZqOXoKMDNKQzhvODd4TFh0K3k3YmZ0YU9vcFY3akZ2aEVvV0lLbHEyeGc4RVowK1QzU1M2K0l6Yityckc5SWxKcXVVKwp3SmZzVTVLNkZIZ2tNUk01NkJvSTNCYUFZT0IvYmhLSWJEQ1N1UDRRd0ZHMkg4Umk3ekxoNXZNNUN6bGphNmxSCm1ER0RxQmxoRDdXTlJERjhJTE53SUxhWGxPKzZ4OWVFUFJ2YkpTNzNCejNxOUtGdkVvQXcrK1ZPTVJNM2YwdVIKYkZDemlDZGo1Sy8yMEtkRk5FRzlobyt0OXBhdndlMi9QeFU5TndJREFRQUJBb0lCQUQxY3lyMFp2MmRHOGhGTwp3RW13bU13N1ROK3ZPZXJLUmtRWVFnV2VtUERsSzdYZDY1ZnE4UURHSGZyeVJEbVZNY2trUkVKSTNYLzNKNHhMCmlrRWR6RW1GMUdjTDV0WDY1Z1oxSm9yZFAwdDcyWWYraFFiTFVpWmJSUU9lMnRCN1RQdXNQTmI1UlI4dXJiMXIKd0VpRHFOWlppS3RRdWsxRFUzS01LOTc4dC8vTktNNCs1OVkrS2lTejU4Y3psSG05RytoM3F4TXRzWldtSVhPNwpjSC9GYmFINGI0amJpQ3JEbXRGRUNyajdZWndLb0M0eFoxZGdha2RsT2k2emZ4RjhMVWNlN1pRNHZNMXpPbVVaCi9GL0wvdjRjMGoxdWY1cXZmRkgyVjBPSXNQUEVWdGR3VUQ4Sk9MaHdrSThtdjdMR1dwRnZlZHlBeFhzZUNPNU8KdnU0eFljRUNnWUVBNHNlUVlXWFZMQVNmU1B4UUlGc0lWTzVrSy9MdDUzd0FCSnkzN0dDSkpBNE1ROEtmRnlCMwpnc3l0bzljaXZ6L0dyWWlhVlc4WGxPWXp4WE5OQ1IwdlNFSGdubWlyQWZvcXR6VnlBVVFCUGZXVE54MkVUNTJsClVxMnpzUUZFMDJxaEVBLzJvWHYwSVlKbmxpV25VMWtoTXhSUllTOTF1Z1Z6Q05VclltUnF6QmNDZ1lFQXkyKzEKSFZzUEd1ZTJnZ2FsVVNlSW53dmRONjRJdFI5NnlqVFJmZ2cybG9wTFRPRHZ1S0pQWHFtRHE3OE1yNkRpUmk5bQpFRWovSFdUSWs2bGdIQnl4UHlmUmNpMXlkMGdaNjdlekRyMTltL1VMb2c5R3RwaHJzRU9YU2lvdzA5YmU0VEdaClB1dWJWa3FGYndOS0N2QnpXQ29VYWdQbC92VFpyZXM4dGNDUUsrRUNnWUVBeHhEV3RDaG5qMVFmWGpuZFBBbXMKcnFEMFhYL0pSY0diWW5FUElmYzdhdUxKOFZFTnhZZENZUmE1OVhBTG1FV3JhUGpZUU5aYnBPRE40U3p0R21yNwo3am1scW1mR2ROM2NVU1loQk90bEM3WmRtNnZWVU8zWkNWSmd3YWVUZXVIR3NBclRPNzFLOTM4NDNwdiszVE1ICjZZYVVTUE1ZTEVwTVNCeVhFSytFNzlFQ2dZRUFqVU53ZklYeW96Z3JYM2JGN09pSzBnWW5BcmJ5alBMakRPNUkKV2ovUnlBOFg0clovUDdKVmN1STY4Rk9sdDM3OElNaGhFd1hkUU1mdkQ3b1padXYxbUdsSjR3THo3U2cvOTVLRAozOFJ0S0pLc0ZVaU9UZFRoVW5CYzZiOEtVTTl2ek9mb0JlME0zSXE2eFM5L2hzRVpGeXVCS1d5emxLcnBUUCtBCkZLVTJkNEVDZ1lCbFlrMFFTemFUdUJyS0pOVzYrT2RPNy9UN2ZXYzlRY1NHUXhPUnNPTHVxb0FScWFlSElCN24KMzFnVG5UdjlPeXcwTTFsaUxtTGwrS1NxcEVwUjV1dWFoUElyWlFKa3B1VXJ6VUtEZG9SQWRIVHgvMkF4clVJSgoxaUU0WlhPVmlpc2xSUUp1Yjg5VGRZS3Z4WExRMnF3UndOY2dtVjBBUndINzE0bm81NHZOQ1E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---
# Source: sdi-catalogue/templates/apache-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: sdi-apache-config

data:
  ssl.conf: |
    Listen 443
    TraceEnable off

    LDAPVerifyServerCert Off
    Header always set Strict-Transport-Security "max-age=15768000; includeSubDomains;"
    Header set X-Content-Type-Options nosniff
    Header set X-XSS-Protection "1; mode=block"

    Header set Content-Security-Policy  "upgrade-insecure-requests; base-uri 'self'; connect-src 'self'  https://*.openstreetmap.org https://*.eea.europa.eu; default-src 'self' blob: 'unsafe-inline' 'unsafe-eval' https://*.eea.europa.eu; font-src 'self' data: https://fonts.gstatic.com https://*.eea.europa.eu; frame-ancestors 'self' https://*.eea.europa.eu; frame-src 'self' https://*.europa.eu https://europa.eu https://*.eea.europa.eu; img-src https: blob: data:; object-src 'none'; script-src 'self' 'unsafe-inline' 'unsafe-eval' blob: https://*.eea.europa.eu https://ajax.aspnetcdn.com https://cdnjs.cloudflare.com https://code.jquery.com https://cdn.jsdelivr.net https://ajax.googleapis.com https://ajax.aspnetcdn.com/; style-src-elem 'self' 'unsafe-inline' https://*.eea.europa.eu https://inspire.ec.europa.eu https://cdnjs.cloudflare.com https://*.googleapis.com https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css https://resources.etf-validator.net"

    RequestHeader set X-HTTPS 1
    Header always set Referrer-Policy "same-origin"
    Header always set Feature-Policy "fullscreen 'none'; microphone 'none'"

    #                 *:443
    SSLProtocol all -TLSv1.1 -TLSv1 -SSLv2 -SSLv3
    SSLOpenSSLConfCmd Curves X25519:secp521r1:secp384r1:prime256v1

    SSLCipherSuite EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH:!DES-CBC3-SHA:!ECDHE-RSA-DES-CBC3-SHA
    SSLHonorCipherOrder on

    LDAPSharedCacheSize 500000
    LDAPCacheEntries 1024
    LDAPCacheTTL 600
    LDAPOpCacheEntries 1024
    LDAPOpCacheTTL 600
    ServerName apache

    <VirtualHost *:80>
        Protocols h2 h2c http/1.1
        RewriteEngine On
        RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
    </VirtualHost>

    <VirtualHost *:443>
        Protocols h2 h2c http/1.1
        SSLEngine on
        SSLCertificateFile    /ssl/server.crt
        SSLCertificateKeyFile /ssl/server.key
        SSLCACertificateFile /ssl/ca-bundle.crt
        #ServerName apache
        ServerAdmin sysadm@eea.europa.eu


        ErrorLog /var/log/apache/logs/error_log
        CustomLog /var/log/apache/logs/access_log combined

        <Directory />
            Options FollowSymLinks
            AllowOverride None
            Allow from all
            Require all granted
        </Directory>

        <Location /server-status>
           SetHandler server-status
           <RequireAny>
             Require ip 10.50.0.0/16
             Require ip 10.92.0.0/16
             Require ip 87.54.7.251
             Require ip 192.168.0.0/16
           </RequireAny>

        </Location>

        Redirect /internal-catalogue /catalogue
        RewriteEngine On
        RewriteRule ^/catalogue/srv/(.*)/csw-(.*) /catalogue/$2/eng/csw  [L,R]

        <Location /catalogue>
            AllowOverride None

            ## Reverse proxy configuration
            ProxyPreserveHost On
            ProxyPass http://gn5:8080/catalogue
            ProxyPassReverse http://gn5:8080/catalogue
        </Location>



        <Location /validator>
            RequestHeader set X-Forwarded-Prefix "/validator"
            RequestHeader set X-Forwarded-Proto "https"
            RequestHeader set X-Forwarded-For "apache"
            ProxyPass http://validator:8080/validator
            ProxyPassReverse http://validator:8080/validator
        </Location>

        ProxyPreserveHost On
        RewriteEngine On

        # Manage /webdav redirections
        RewriteRule ^/webdav/datastore/public/?$ /datastore/public [R=301,L,QSD]
        RewriteRule ^/webdav/datastore/?$       /datastore/public [R=301,L,QSD]
        RewriteRule ^/webdav/datastore/public/(.+)$ /datastore/public/$1 [R=301,L,QSD]

        RewriteRule ^/webdav/datastore/internal/$ /datastore/internal [R=301,L,QSD]
        RewriteRule ^/webdav/datastore/internal/(.+)$ /datastore/internal/$1 [R=301,L,QSD]
        
        RewriteRule ^/datastore/internal/?(.*)$ /datashare/apps/files/files?dir=/datastore/internal/$1 [R=301,L,QSD]
        
        # Manage directories (without a dot in the name)
        RewriteRule ^/datastore/public/(?!.*\..*$)(.*)$ /datastore/public?path=/$1 [R=301,L]

        # Manage files (with a dot in the name)
        RewriteRule ^/datastore/public/(.*\..*)$ http://nextcloud/public.php/dav/files/sptXqwkQr5g7Bp5/$1 [P,L]

        # Manage root datastore redirection
        RewriteRule ^/datastore/public/?$ http://nextcloud/s/sptXqwkQr5g7Bp5 [P,L]
        
        # Proxy record datastore to GeoNetwork
        RewriteRule ^/data/([^/]+)$ http://gn5:8080/catalogue/srv/api/records/$1/datastore [P,L]
        ProxyPassReverse ^/data/([^/]+)$ http://gn5:8080/catalogue/srv/api/records/$1/datastore

        # Add headers for proxied datastore requests
        <LocationMatch "^/datastore">
            RequestHeader set X-Real-IP expr=%{REMOTE_ADDR}
            RequestHeader set X-Forwarded-Proto "https"
            ProxyPassReverseCookiePath /datashare /datastore
        </LocationMatch>
        

        #<Location /datastore/internal>
        #    ProxyPass http://nextcloud/f/512629
        #    ProxyPassReverse /datastore/internal
        #    ProxyPassReverseCookiePath /datashare /datastore
        #</Location>

        <Location /datastore/restricted>
            ProxyPass http://nextcloud/f/512630
            ProxyPassReverse /datastore/restricted
            ProxyPassReverseCookiePath /datashare /datastore
        </Location>


        <Location /datashare>
            ProxyPreserveHost On
            RewriteEngine On
            Order deny,allow
            Allow from all
            ProxyPass http://nextcloud
            ProxyPassReverse http://nextcloud
            ProxyPassReverseCookiePath /datashare /datashare
            
            # Send the client IP to Nextcloud
            RequestHeader set X-Real-IP expr=%{REMOTE_ADDR}
            RequestHeader set X-Forwarded-Proto "https"
         </Location>

    #   Allow CORS for the download endpoint
    #   https://taskman.eionet.europa.eu/issues/285084
        <LocationMatch "^/datashare/s/.*/download$">
            Header set Access-Control-Allow-Origin "*"
            Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
            Header set Access-Control-Allow-Headers "Content-Type, Authorization"
        </LocationMatch>

    #    SSLProxyEngine On

        <Location /data>
           ProxyPreserveHost On
           AllowOverride None
           RequestHeader unset Authorization
        </Location>

        IncludeOptional conf/extra/extra-mime-types.conf
    </VirtualHost>
---
# Source: sdi-catalogue/templates/cachain-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-cacrts

# Apache complains if the ca-bundle is empty
# The server.crt is identical to *.eea.europa.eu cert.
data:
  ca-bundle.crt: |-
    
    -----BEGIN CERTIFICATE-----
    MIIGHDCCBQSgAwIBAgIQIlYLj4Y0vg0L4JN7pO7tADANBgkqhkiG9w0BAQsFADBM
    MQswCQYDVQQGEwJMVjENMAsGA1UEBxMEUmlnYTERMA8GA1UEChMIR29HZXRTU0wx
    GzAZBgNVBAMTEkdvR2V0U1NMIFJTQSBEViBDQTAeFw0yMzA1MTUwMDAwMDBaFw0y
    NDA2MTQyMzU5NTlaMBoxGDAWBgNVBAMMDyouZWVhLmV1cm9wYS5ldTCCASIwDQYJ
    KoZIhvcNAQEBBQADggEPADCCAQoCggEBAJzoA2EO6tkWrBi0jMzCvY24Fq488CQ7
    9mq7wgH4MHLXclqbloK6SNBt6xpFPVjLG1erek5wY478P51gOSkJfPoH54RcmrSx
    yhsZSD54T2w1kZkxytJ8MC11jZqV2E249FQroJPwYVj4BFEZC2uce5HbWSa0T1py
    Mxw53QWcBs73gTp+Kl7o0OEp6KefweDqeoHeA/Qz+o3aYC+WlPiZYJ7JBQ0TlRyN
    Pr35bCPK8Eed5JIZRI/l/CcXSnUCDSobqrM2UrC877pe4Ls71+zowhH0qS6EMMSs
    /TE8hbMs8JkXnBiAwiNJfpGeA1JT9kBmkSXT5t/VbDvFyJclyytRcd0CAwEAAaOC
    AyowggMmMB8GA1UdIwQYMBaAFPn7UMSLZ7tnZP6DIaapzj9VhJOZMB0GA1UdDgQW
    BBRnzr42JvNXIT8UqA2RPPdkCLHT9zAOBgNVHQ8BAf8EBAMCBaAwDAYDVR0TAQH/
    BAIwADAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwSwYDVR0gBEQwQjA2
    BgsrBgEEAbIxAQICQDAnMCUGCCsGAQUFBwIBFhlodHRwczovL2Nwcy51c2VydHJ1
    c3QuY29tMAgGBmeBDAECATA9BgNVHR8ENjA0MDKgMKAuhixodHRwOi8vY3JsLnVz
    ZXJ0cnVzdC5jb20vR29HZXRTU0xSU0FEVkNBLmNybDBvBggrBgEFBQcBAQRjMGEw
    OAYIKwYBBQUHMAKGLGh0dHA6Ly9jcnQudXNlcnRydXN0LmNvbS9Hb0dldFNTTFJT
    QURWQ0EuY3J0MCUGCCsGAQUFBzABhhlodHRwOi8vb2NzcC51c2VydHJ1c3QuY29t
    MCkGA1UdEQQiMCCCDyouZWVhLmV1cm9wYS5ldYINZWVhLmV1cm9wYS5ldTCCAX0G
    CisGAQQB1nkCBAIEggFtBIIBaQFnAHUAdv+IPwq2+5VRwmHM9Ye6NLSkzbsp3GhC
    Cp/mZ0xaOnQAAAGIHv1FIQAABAMARjBEAiBxNf6/ausitoD7j6C8rZUymMyHb8dG
    6v+m5LodgLyXjAIgB5JznXODcNd+iUQurkYFsqbD6miBmMIo8TwQ6pJU/UAAdgDa
    tr9rP7W2Ip+bwrtca+hwkXFsu1GEhTS9pD0wSNf7qwAAAYge/UV0AAAEAwBHMEUC
    IGOA2DdFbfA2yJ+cLjcrNdwSCqUbhk4hlqRL3252m+kaAiEAikE+nbiPhJJMMky2
    rMqJc2DdPhQdPbgI3TD1N6p/rr4AdgDuzdBk1dsazsVct520zROiModGfLzs3sNR
    SFlGcR+1mwAAAYge/UVPAAAEAwBHMEUCIDrwC8ye0m7Kat7ge84L4wC0yIx69rZ1
    z9Bz1zYg7fkeAiEAh+b50h23KmxQP+0lp3DggPrGYSRcSZOLEkUF2CQURQ8wDQYJ
    KoZIhvcNAQELBQADggEBACt1aHAyyiuy9SBa7rg+Fmgck96sgW+MPt6pwoeYQyO9
    K5rpBqMV1khHC7EZmfVBuRMKYYXCyEi3SGo9QpLK9xGwap0r1KStQM12cpgkdqTw
    Jn+OqryS9oQP6AyFj8aTAJC+udzYn0XstZe3wW01f9FlNAGnNQdDIpbyI85UI7qT
    xOha4tPz64EO+RwFO4wtNQHrphWtEpgW0/zAXuGVbP7zRCRCb8oqKNFBZ4i3S6Mf
    7Am1aTShWnyzGhHq+FFWdRtfXF7+SCDH3lUlD8nRoDxH44NOZOtixP8NlyS3Q4XP
    unxGTqUwu04MTDcPEd2E4pjn/ayWVfEyh4aXXF36p2Q=
    -----END CERTIFICATE-----
    
    
    -----BEGIN CERTIFICATE-----
    MIIF1zCCA7+gAwIBAgIRAJOLsI5imHtPdfmMtqUEXJYwDQYJKoZIhvcNAQEMBQAw
    gYgxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpOZXcgSmVyc2V5MRQwEgYDVQQHEwtK
    ZXJzZXkgQ2l0eTEeMBwGA1UEChMVVGhlIFVTRVJUUlVTVCBOZXR3b3JrMS4wLAYD
    VQQDEyVVU0VSVHJ1c3QgUlNBIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MB4XDTE4
    MDkwNjAwMDAwMFoXDTI4MDkwNTIzNTk1OVowTDELMAkGA1UEBhMCTFYxDTALBgNV
    BAcTBFJpZ2ExETAPBgNVBAoTCEdvR2V0U1NMMRswGQYDVQQDExJHb0dldFNTTCBS
    U0EgRFYgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCfwF4hD6E1
    kLglXs1n2fH5vMQukCGyyD4LqLsc3pSzeh8we7njU4TB85BH5YXqcfwiH1Sf78aB
    hk1FgXoAZ3EQrF49We8mnTtTPFRnMwEHLJRpY9I/+peKeAZNL0MJG5zM+9gmcSpI
    OTI6p7MPela72g0pBQjwcExYLqFFVsnroEPTRRlmfTBTRi9r7rYcXwIct2VUCRmj
    jR1GX13op370YjYwgGv/TeYqUWkNiEjWNskFDEfxSc0YfoBwwKdPNfp6t/5+RsFn
    lgQKstmFLQbbENsdUEpzWEvZUpDC4qPvRrxEKcF0uLoZhEnxhskwXSTC64BNtc+l
    VEk7/g/be8svAgMBAAGjggF1MIIBcTAfBgNVHSMEGDAWgBRTeb9aqitKz1SA4dib
    wJ3ysgNmyzAdBgNVHQ4EFgQU+ftQxItnu2dk/oMhpqnOP1WEk5kwDgYDVR0PAQH/
    BAQDAgGGMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0lBBYwFAYIKwYBBQUHAwEG
    CCsGAQUFBwMCMCIGA1UdIAQbMBkwDQYLKwYBBAGyMQECAkAwCAYGZ4EMAQIBMFAG
    A1UdHwRJMEcwRaBDoEGGP2h0dHA6Ly9jcmwudXNlcnRydXN0LmNvbS9VU0VSVHJ1
    c3RSU0FDZXJ0aWZpY2F0aW9uQXV0aG9yaXR5LmNybDB2BggrBgEFBQcBAQRqMGgw
    PwYIKwYBBQUHMAKGM2h0dHA6Ly9jcnQudXNlcnRydXN0LmNvbS9VU0VSVHJ1c3RS
    U0FBZGRUcnVzdENBLmNydDAlBggrBgEFBQcwAYYZaHR0cDovL29jc3AudXNlcnRy
    dXN0LmNvbTANBgkqhkiG9w0BAQwFAAOCAgEAXXRDKHiA5DOhNKsztwayc8qtlK4q
    Vt2XNdlzXn4RyZIsC9+SBi0Xd4vGDhFx6XX4N/fnxlUjdzNN/BYY1gS1xK66Uy3p
    rw9qI8X12J4er9lNNhrsvOcjB8CT8FyvFu94j3Bs427uxcSukhYbERBAIN7MpWKl
    VWxT3q8GIqiEYVKa/tfWAvnOMDDSKgRwMUtggr/IE77hekQm20p7e1BuJODf1Q7c
    FPt7T74m3chg+qu0xheLI6HsUFuOxc7R5SQlkFvaVY5tmswfWpY+rwhyJW+FWNbT
    uNXkxR4v5KOQPWrY100/QN68/j17paKuSXNcsr56snuB/Dx+MACLBdsF35HxPadx
    78vkfQ37WcVmKZtHrHJQ/QUyjxdG8fezMsh0f+puUln/O+NlsFtipve8qYa9h/K5
    yD0oZN93ChWve78XrV4vCpjO75Nk5B8O9CWQqGTHbhkgvjyb9v/B+sYJqB22/NLl
    R4RPvbmqDJGeEI+4u6NJ5YiLIVVsX+dyfFP8zUbSsj6J34RyCYKBbQ4L+r7k8Srs
    LY51WUFP292wkFDPSDmV7XsUNTDOZoQcBh2Fycf7xFfxeA+6ERx2d8MpPPND7yS2
    1dkf+SY5SdpSbAKtYmbqb9q8cZUDEImNWJFUVHBLDOrnYhGwJudE3OBXRTxNhMDm
    IXnjEeWrFvAZQhk=
    -----END CERTIFICATE-----
    -----BEGIN CERTIFICATE-----
    MIIFgTCCBGmgAwIBAgIQOXJEOvkit1HX02wQ3TE1lTANBgkqhkiG9w0BAQwFADB7
    MQswCQYDVQQGEwJHQjEbMBkGA1UECAwSR3JlYXRlciBNYW5jaGVzdGVyMRAwDgYD
    VQQHDAdTYWxmb3JkMRowGAYDVQQKDBFDb21vZG8gQ0EgTGltaXRlZDEhMB8GA1UE
    AwwYQUFBIENlcnRpZmljYXRlIFNlcnZpY2VzMB4XDTE5MDMxMjAwMDAwMFoXDTI4
    MTIzMTIzNTk1OVowgYgxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpOZXcgSmVyc2V5
    MRQwEgYDVQQHEwtKZXJzZXkgQ2l0eTEeMBwGA1UEChMVVGhlIFVTRVJUUlVTVCBO
    ZXR3b3JrMS4wLAYDVQQDEyVVU0VSVHJ1c3QgUlNBIENlcnRpZmljYXRpb24gQXV0
    aG9yaXR5MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAgBJlFzYOw9sI
    s9CsVw127c0n00ytUINh4qogTQktZAnczomfzD2p7PbPwdzx07HWezcoEStH2jnG
    vDoZtF+mvX2do2NCtnbyqTsrkfjib9DsFiCQCT7i6HTJGLSR1GJk23+jBvGIGGqQ
    Ijy8/hPwhxR79uQfjtTkUcYRZ0YIUcuGFFQ/vDP+fmyc/xadGL1RjjWmp2bIcmfb
    IWax1Jt4A8BQOujM8Ny8nkz+rwWWNR9XWrf/zvk9tyy29lTdyOcSOk2uTIq3XJq0
    tyA9yn8iNK5+O2hmAUTnAU5GU5szYPeUvlM3kHND8zLDU+/bqv50TmnHa4xgk97E
    xwzf4TKuzJM7UXiVZ4vuPVb+DNBpDxsP8yUmazNt925H+nND5X4OpWaxKXwyhGNV
    icQNwZNUMBkTrNN9N6frXTpsNVzbQdcS2qlJC9/YgIoJk2KOtWbPJYjNhLixP6Q5
    D9kCnusSTJV882sFqV4Wg8y4Z+LoE53MW4LTTLPtW//e5XOsIzstAL81VXQJSdhJ
    WBp/kjbmUZIO8yZ9HE0XvMnsQybQv0FfQKlERPSZ51eHnlAfV1SoPv10Yy+xUGUJ
    5lhCLkMaTLTwJUdZ+gQek9QmRkpQgbLevni3/GcV4clXhB4PY9bpYrrWX1Uu6lzG
    KAgEJTm4Diup8kyXHAc/DVL17e8vgg8CAwEAAaOB8jCB7zAfBgNVHSMEGDAWgBSg
    EQojPpbxB+zirynvgqV/0DCktDAdBgNVHQ4EFgQUU3m/WqorSs9UgOHYm8Cd8rID
    ZsswDgYDVR0PAQH/BAQDAgGGMA8GA1UdEwEB/wQFMAMBAf8wEQYDVR0gBAowCDAG
    BgRVHSAAMEMGA1UdHwQ8MDowOKA2oDSGMmh0dHA6Ly9jcmwuY29tb2RvY2EuY29t
    L0FBQUNlcnRpZmljYXRlU2VydmljZXMuY3JsMDQGCCsGAQUFBwEBBCgwJjAkBggr
    BgEFBQcwAYYYaHR0cDovL29jc3AuY29tb2RvY2EuY29tMA0GCSqGSIb3DQEBDAUA
    A4IBAQAYh1HcdCE9nIrgJ7cz0C7M7PDmy14R3iJvm3WOnnL+5Nb+qh+cli3vA0p+
    rvSNb3I8QzvAP+u431yqqcau8vzY7qN7Q/aGNnwU4M309z/+3ri0ivCRlv79Q2R+
    /czSAaF9ffgZGclCKxO/WIu6pKJmBHaIkU4MiRTOok3JMrO66BQavHHxW/BBC5gA
    CiIDEOUMsfnNkjcZ7Tvx5Dq2+UUTJnWvu6rvP3t3O9LEApE9GQDTF1w52z97GA1F
    zZOFli9d31kWTz9RvdVFGD/tSo7oBmF0Ixa1DVBzJ0RHfxBdiSprhTEUxOipakyA
    vGp4z7h/jnZymQyd/teRCBaho1+V
    -----END CERTIFICATE-----
    
  chain.crt: |-
    
    -----BEGIN CERTIFICATE-----
    MIIF1zCCA7+gAwIBAgIRAJOLsI5imHtPdfmMtqUEXJYwDQYJKoZIhvcNAQEMBQAw
    gYgxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpOZXcgSmVyc2V5MRQwEgYDVQQHEwtK
    ZXJzZXkgQ2l0eTEeMBwGA1UEChMVVGhlIFVTRVJUUlVTVCBOZXR3b3JrMS4wLAYD
    VQQDEyVVU0VSVHJ1c3QgUlNBIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MB4XDTE4
    MDkwNjAwMDAwMFoXDTI4MDkwNTIzNTk1OVowTDELMAkGA1UEBhMCTFYxDTALBgNV
    BAcTBFJpZ2ExETAPBgNVBAoTCEdvR2V0U1NMMRswGQYDVQQDExJHb0dldFNTTCBS
    U0EgRFYgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCfwF4hD6E1
    kLglXs1n2fH5vMQukCGyyD4LqLsc3pSzeh8we7njU4TB85BH5YXqcfwiH1Sf78aB
    hk1FgXoAZ3EQrF49We8mnTtTPFRnMwEHLJRpY9I/+peKeAZNL0MJG5zM+9gmcSpI
    OTI6p7MPela72g0pBQjwcExYLqFFVsnroEPTRRlmfTBTRi9r7rYcXwIct2VUCRmj
    jR1GX13op370YjYwgGv/TeYqUWkNiEjWNskFDEfxSc0YfoBwwKdPNfp6t/5+RsFn
    lgQKstmFLQbbENsdUEpzWEvZUpDC4qPvRrxEKcF0uLoZhEnxhskwXSTC64BNtc+l
    VEk7/g/be8svAgMBAAGjggF1MIIBcTAfBgNVHSMEGDAWgBRTeb9aqitKz1SA4dib
    wJ3ysgNmyzAdBgNVHQ4EFgQU+ftQxItnu2dk/oMhpqnOP1WEk5kwDgYDVR0PAQH/
    BAQDAgGGMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0lBBYwFAYIKwYBBQUHAwEG
    CCsGAQUFBwMCMCIGA1UdIAQbMBkwDQYLKwYBBAGyMQECAkAwCAYGZ4EMAQIBMFAG
    A1UdHwRJMEcwRaBDoEGGP2h0dHA6Ly9jcmwudXNlcnRydXN0LmNvbS9VU0VSVHJ1
    c3RSU0FDZXJ0aWZpY2F0aW9uQXV0aG9yaXR5LmNybDB2BggrBgEFBQcBAQRqMGgw
    PwYIKwYBBQUHMAKGM2h0dHA6Ly9jcnQudXNlcnRydXN0LmNvbS9VU0VSVHJ1c3RS
    U0FBZGRUcnVzdENBLmNydDAlBggrBgEFBQcwAYYZaHR0cDovL29jc3AudXNlcnRy
    dXN0LmNvbTANBgkqhkiG9w0BAQwFAAOCAgEAXXRDKHiA5DOhNKsztwayc8qtlK4q
    Vt2XNdlzXn4RyZIsC9+SBi0Xd4vGDhFx6XX4N/fnxlUjdzNN/BYY1gS1xK66Uy3p
    rw9qI8X12J4er9lNNhrsvOcjB8CT8FyvFu94j3Bs427uxcSukhYbERBAIN7MpWKl
    VWxT3q8GIqiEYVKa/tfWAvnOMDDSKgRwMUtggr/IE77hekQm20p7e1BuJODf1Q7c
    FPt7T74m3chg+qu0xheLI6HsUFuOxc7R5SQlkFvaVY5tmswfWpY+rwhyJW+FWNbT
    uNXkxR4v5KOQPWrY100/QN68/j17paKuSXNcsr56snuB/Dx+MACLBdsF35HxPadx
    78vkfQ37WcVmKZtHrHJQ/QUyjxdG8fezMsh0f+puUln/O+NlsFtipve8qYa9h/K5
    yD0oZN93ChWve78XrV4vCpjO75Nk5B8O9CWQqGTHbhkgvjyb9v/B+sYJqB22/NLl
    R4RPvbmqDJGeEI+4u6NJ5YiLIVVsX+dyfFP8zUbSsj6J34RyCYKBbQ4L+r7k8Srs
    LY51WUFP292wkFDPSDmV7XsUNTDOZoQcBh2Fycf7xFfxeA+6ERx2d8MpPPND7yS2
    1dkf+SY5SdpSbAKtYmbqb9q8cZUDEImNWJFUVHBLDOrnYhGwJudE3OBXRTxNhMDm
    IXnjEeWrFvAZQhk=
    -----END CERTIFICATE-----
    -----BEGIN CERTIFICATE-----
    MIIFgTCCBGmgAwIBAgIQOXJEOvkit1HX02wQ3TE1lTANBgkqhkiG9w0BAQwFADB7
    MQswCQYDVQQGEwJHQjEbMBkGA1UECAwSR3JlYXRlciBNYW5jaGVzdGVyMRAwDgYD
    VQQHDAdTYWxmb3JkMRowGAYDVQQKDBFDb21vZG8gQ0EgTGltaXRlZDEhMB8GA1UE
    AwwYQUFBIENlcnRpZmljYXRlIFNlcnZpY2VzMB4XDTE5MDMxMjAwMDAwMFoXDTI4
    MTIzMTIzNTk1OVowgYgxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpOZXcgSmVyc2V5
    MRQwEgYDVQQHEwtKZXJzZXkgQ2l0eTEeMBwGA1UEChMVVGhlIFVTRVJUUlVTVCBO
    ZXR3b3JrMS4wLAYDVQQDEyVVU0VSVHJ1c3QgUlNBIENlcnRpZmljYXRpb24gQXV0
    aG9yaXR5MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAgBJlFzYOw9sI
    s9CsVw127c0n00ytUINh4qogTQktZAnczomfzD2p7PbPwdzx07HWezcoEStH2jnG
    vDoZtF+mvX2do2NCtnbyqTsrkfjib9DsFiCQCT7i6HTJGLSR1GJk23+jBvGIGGqQ
    Ijy8/hPwhxR79uQfjtTkUcYRZ0YIUcuGFFQ/vDP+fmyc/xadGL1RjjWmp2bIcmfb
    IWax1Jt4A8BQOujM8Ny8nkz+rwWWNR9XWrf/zvk9tyy29lTdyOcSOk2uTIq3XJq0
    tyA9yn8iNK5+O2hmAUTnAU5GU5szYPeUvlM3kHND8zLDU+/bqv50TmnHa4xgk97E
    xwzf4TKuzJM7UXiVZ4vuPVb+DNBpDxsP8yUmazNt925H+nND5X4OpWaxKXwyhGNV
    icQNwZNUMBkTrNN9N6frXTpsNVzbQdcS2qlJC9/YgIoJk2KOtWbPJYjNhLixP6Q5
    D9kCnusSTJV882sFqV4Wg8y4Z+LoE53MW4LTTLPtW//e5XOsIzstAL81VXQJSdhJ
    WBp/kjbmUZIO8yZ9HE0XvMnsQybQv0FfQKlERPSZ51eHnlAfV1SoPv10Yy+xUGUJ
    5lhCLkMaTLTwJUdZ+gQek9QmRkpQgbLevni3/GcV4clXhB4PY9bpYrrWX1Uu6lzG
    KAgEJTm4Diup8kyXHAc/DVL17e8vgg8CAwEAAaOB8jCB7zAfBgNVHSMEGDAWgBSg
    EQojPpbxB+zirynvgqV/0DCktDAdBgNVHQ4EFgQUU3m/WqorSs9UgOHYm8Cd8rID
    ZsswDgYDVR0PAQH/BAQDAgGGMA8GA1UdEwEB/wQFMAMBAf8wEQYDVR0gBAowCDAG
    BgRVHSAAMEMGA1UdHwQ8MDowOKA2oDSGMmh0dHA6Ly9jcmwuY29tb2RvY2EuY29t
    L0FBQUNlcnRpZmljYXRlU2VydmljZXMuY3JsMDQGCCsGAQUFBwEBBCgwJjAkBggr
    BgEFBQcwAYYYaHR0cDovL29jc3AuY29tb2RvY2EuY29tMA0GCSqGSIb3DQEBDAUA
    A4IBAQAYh1HcdCE9nIrgJ7cz0C7M7PDmy14R3iJvm3WOnnL+5Nb+qh+cli3vA0p+
    rvSNb3I8QzvAP+u431yqqcau8vzY7qN7Q/aGNnwU4M309z/+3ri0ivCRlv79Q2R+
    /czSAaF9ffgZGclCKxO/WIu6pKJmBHaIkU4MiRTOok3JMrO66BQavHHxW/BBC5gA
    CiIDEOUMsfnNkjcZ7Tvx5Dq2+UUTJnWvu6rvP3t3O9LEApE9GQDTF1w52z97GA1F
    zZOFli9d31kWTz9RvdVFGD/tSo7oBmF0Ixa1DVBzJ0RHfxBdiSprhTEUxOipakyA
    vGp4z7h/jnZymQyd/teRCBaho1+V
    -----END CERTIFICATE-----
---
# Source: sdi-catalogue/templates/gn46-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: sdi-gn46-config

data:
  security.properties: |
    logout.success.url=https://galliwasp.eea.europa.eu/catalogue/srv/eng/catalog.search
    loginForm=https://galliwasp.eea.europa.eu/catalogue/srv/eng/catalog.signin
    loginErrorForm=https://galliwasp.eea.europa.eu/catalogue/srv/engcatalog.signin?failure=true
---
# Source: sdi-catalogue/templates/gn5-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: sdi-gn5-config

data:
  gn5-config.yaml: |
    server:
      port: 8080
      servlet:
        context-path: /catalogue

    geonetwork:
      url: https://apache
      url_with_context: https://apache//catalogue
      4:
        url: http://gn46:8080//catalogue
      index:
        url: http://elasticsearch:9200
        indexRecordName: gn5-records

      directory:
        data: /var/local/gis_sdi/cataloguestore
        metadata:
          layout: UUID
          privileges: NONE

      openapi:
        url: https://apache
        
      security:
        provider: ldap
        createdUser:
          group: eea_users
        # Enabled if provider is ldap
        ldap:
          url: ldaps://ldap.eionet.europa.eu
          # url: # Empty use embedded LDAP
          base: o=EIONET,l=Europe
          user-search-dn: ou=Users
          user-search-filter: (&(|(objectclass=eionetAccount))(|(uid={0})(|(mailPrimaryAddress={0})(mail={0}))))
          attributes:
            username: uid
            email: email
            name: givenName
            surname: sn
---
# Source: sdi-catalogue/templates/nextcloud-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: nextcloud-config

data:
  config.php: |
    <?php
    $CONFIG = array (
      'htaccess.RewriteBase' => '/',
      'apps_paths' => 
      array (
        0 => 
        array (
          'path' => '/var/www/html/apps',
          'url' => '/apps',
          'writable' => false,
        ),
        1 => 
        array (
          'path' => '/var/www/html/custom_apps',
          'url' => '/custom_apps',
          'writable' => true,
        ),
      ),
      'instanceid' => 'ocvezsf3198o',
      'passwordsalt' => '',
      'secret' => '',
      'trusted_domains' => 
      array (
        0 => '10.50.4.60:5000',
      ),
      'datadirectory' => '/var/www/html/data',
      'dbtype' => 'mysql',
      'overwrite.cli.url' => 'https://apache/datashare',
      'dbname' => 'ncdb',
      'dbhost' => 'nextcloud-db',
      'dbport' => '3306',
      'dbtableprefix' => 'oc_',
      'mysql.utf8mb4' => true,
      'dbuser' => '',
      'dbpassword' => '',
      'overwritewebroot' => '/datashare',
      'lost_password_link' => 'disabled',
      'simpleSignUpLink.shown' => false,
      'overwritehost' => 'apache',
      'overwriteprotocol' => 'https',
      'loglevel' => 2,
      'defaultapp' => 'files',
      'default_phone_region' => 'DK',
      'mail_from_address' => 'datashrusr',
      'mail_smtpmode' => 'smtp',
      'mail_sendmailmode' => 'smtp',
      'mail_domain' => 'eionet.europa.eu',
      'mail_smtphost' => 'postfix',
      'mail_smtpport' => '25',
      'skeletondirectory' => '',
      'localstorage.allowsymlinks' => true,
      'maintenance_window_start' => 3,
      'memcache.local' => '\\OC\\Memcache\\APCu'
    );
---
# Source: sdi-catalogue/templates/ogcapi-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: sdi-ogcapi-config

data:
  bootstrap.yml: |-
    server:
      port: 8080
      address: ogcapi
      #forward-headers-strategy: NATIVE
      forward-headers-strategy: FRAMEWORK
      servlet:
        #context-path: /ogcapi
        encoding:
          charset: UTF-8
          force-response: true
      instance-id: ${spring.application.name}:${spring.application.instance_id:${spring.cloud.client.ip-address}}:${server.port}
    spring:
      application.name: ogc-records-service
      main.banner-mode: off
      cloud:
        loadbalancer.ribbon.enabled: false # ribbon is in maintenance mode and should be replaced by spring-cloud-loadbalancer
        config:
          fail-fast: true
          retry:
            max-attempts: 20
          discovery:
            enabled: true
            service-id: config-service

    eureka:
      instance:
        hostname: ${spring.application.name}
        instance-id: ${server.instance-id}
        preferIpAddress: true
        lease-expiration-duration-in-seconds: 30
        lease-renewal-interval-in-seconds: 30
      client:
        enabled: true
        registerWithEureka: true
        fetchRegistry: true
        registry-fetch-interval-seconds: 30
        serviceUrl:
          defaultZone: ${eureka.server.url:http://localhost:8761/eureka}
        healthcheck:
          enabled: true

    ---
    # Use this profile when running on a GN4 database on localhost and Elasticsearch index.
    # Turn off security, config & discover.
    spring:
      profiles: standalone
      rabbitmq.host: localhost
      datasource:
        driver-class-name: org.postgresql.Driver
        url: jdbc:postgresql://postgres-geonetwork:5432/geonetwork_sdi
        username: geonetwork
        password: 
      jpa:
        database-platform: org.hibernate.dialect.PostgreSQLDialect
        jpa.generate-ddl: false
        jpa.hibernate.ddl-auto: none
      cloud:
        config:
          discovery:
            enabled: false
          enabled: false
    management:
      health.ldap.enabled: false
    eureka:
      client:
        enabled: false
        registerWithEureka: false
        fetch-registry: false
    gn:
      baseurl: https://apache:443/catalogue/api
      language:
        default: eng
      linkToLegacyGN4: true
      legacy.url: https://apache:443/catalogue
      index:
        url: http://elasticsearch:9200
        records: gn-records
        username:
        password:
      search:
        queryFilter: '+isTemplate:n AND -indexingError:true'
        queryBase: '(any.\*:(${any}) OR resourceTitleObject.\*:(${any})^2)'
        trackTotalHits: true
        scoreConfig: >
          {
            "boost": "5",
            "functions": [
              { // Boost down member of a series
                "filter": { "exists": { "field": "parentUuid" } },
                "weight": 0.3
              },
              { // Boost down obsolete records
                "filter": { "match": { "cl_status.key": "obsolete" } },
                "weight": 0.3
              },
              {
                "gauss": {
                  "dateStamp": {
                    "scale": "365d",
                    "offset": "90d",
                    "decay": 0.5
                  }
                }
              }
            ],
            "score_mode": "multiply"
          }
        sortables:
          - "relevance"
          - "createDate:desc"
          - "resourceTitleObject.default.keyword"
          - "rating:desc"
          - "popularity:desc"
        formats:
          - name: html
            mimeType: text/html
            responseProcessor: JsonUserAndSelectionAwareResponseProcessorImpl
            operations:
              - root
              - conformance
              - collections
              - collection
              - items
              - item
          -
            name: xml
            mimeType: application/xml
            responseProcessor: XmlResponseProcessorImpl
            operations:
              - root
              - collections
              - collection
              - items
              - item
          -
            name: json
            mimeType: application/json
            responseProcessor: JsonUserAndSelectionAwareResponseProcessorImpl
            operations:
              - root
              - conformance
              - collections
              - collection
              - items
              - item
          -
            name : gn
            mimeType : application/gn+xml
            responseProcessor: XsltResponseProcessorImpl
          -
            name: opensearch
            mimeType: application/opensearchdescription+xml
            operations:
              - collection
          -
            name : schema.org
            mimeType : application/ld+json
            responseProcessor: JsonLdResponseProcessorImpl
            operations:
              - items
              - item
          -
            name: dcat
            mimeType: application/rdf+xml
            responseProcessor: DcatCatalogResponseProcessorImpl
            operations:
              - items
              - item
          -
            name : dcat_turtle
            mimeType : text/turtle
            responseProcessor: JsonUserAndSelectionAwareResponseProcessorImpl
            operations :
              - item
          #      -
          #        name : iso19139
          #        mimeType : application/iso19139+xml
          #        responseProcessor: XsltResponseProcessorImpl
          #      -
          #        name : iso19115-3
          #        mimeType : application/iso19115-3+xml
          #        responseProcessor: XsltResponseProcessorImpl
          -
            name : rss
            mimeType : application/rss+xml
            responseProcessor: RssResponseProcessorImpl
            operations:
              - items
          -
            name : geojson
            mimeType : application/geo+json
            responseProcessor: GeoJsonResponseProcessorImpl
            operations:
              - items
              - item
        defaultMimeType: text/html
        sources:
          - "resourceTitleObject"
          - "resourceAbstractObject"
          - "resourceType"
          - "overview"
          - "uuid"
          - "schema"
          - "link"
          - "allKeywords"
          - "contactForResource"
          - "cl_status"
          - "edit"


    metadata:
      license:
        name: GNU General Public License v2.0
        url: https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html

    springfox:
      documentation:
        swaggerUi:
          baseUrl: /catalogue/api/openapi
        openApi:
          v3:
            path: /catalogue/api/openapi/v3/api-docs
        swagger:
          v2:
            path: /catalogue/api/openapi/v2/api-docs
---
# Source: sdi-catalogue/templates/validator-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: validator-config

data:
  # Apache and squid in validator pod doesn't start if /etc/network/interfaces doesn't exist
  interfaces: |-
    auto eth0
---
# Source: sdi-catalogue/templates/gis-sdi-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: gis-sdi
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: gis-sdi
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 2Ti
---
# Source: sdi-catalogue/templates/sdi-apache-conf-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-apache-configuration
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: apache-conf
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 10Mi
---
# Source: sdi-catalogue/templates/sdi-apache-log-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-apache-log
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: apache-log

spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 1Gi
---
# Source: sdi-catalogue/templates/sdi-apache-www-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-apache-www
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: apache-www
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 5Gi
---
# Source: sdi-catalogue/templates/sdi-cron-opt-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-cron-opt
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-cron-opt
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 100Gi
---
# Source: sdi-catalogue/templates/sdi-esdata-node0-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-esdata-node0
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-esdata-node0
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
---
# Source: sdi-catalogue/templates/sdi-esdata-node1-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-esdata-node1
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-esdata-node1
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
---
# Source: sdi-catalogue/templates/sdi-etc-openldap-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-etc-openldap
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-etc-openldap
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Mi
---
# Source: sdi-catalogue/templates/sdi-etc-samba-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-etc-samba
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-etc-samba
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Mi
---
# Source: sdi-catalogue/templates/sdi-etc-smbldap-tools-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-etc-smbldap-tools
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-etc-smbldap-tools
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Mi
---
# Source: sdi-catalogue/templates/sdi-gn5-data-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-gn5-data
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-gn5-data
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
---
# Source: sdi-catalogue/templates/sdi-nextcloud-app-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-nextcloud-app
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-nextcloud-app
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 40Gi
---
# Source: sdi-catalogue/templates/sdi-nextcloud-redis-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-nextcloud-redis
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-nextcloud-redis

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Mi
---
# Source: sdi-catalogue/templates/sdi-public-catalogue-data-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-public-catalogue-data
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-public-catalogue-data
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
---
# Source: sdi-catalogue/templates/sdi-validator-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-validator
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-validator
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
---
# Source: sdi-catalogue/templates/sdi-var-lib-ldap-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-var-lib-ldap
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-var-lib-ldap
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Mi
---
# Source: sdi-catalogue/templates/sdi-var-lib-samba-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sdi-var-lib-samba
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: sdi-var-lib-samba
  annotations:
    "helm.sh/resource-policy": keep

spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Mi
---
# Source: sdi-catalogue/templates/ssl-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: ssl
  name: release-name-ssl

spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 1Gi
---
# Source: sdi-catalogue/charts/postfix/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: postfix
  labels:
    helm.sh/chart: postfix-3.2.0
    app.kubernetes.io/name: postfix
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "3.5-1.2"
    app.kubernetes.io/managed-by: Helm

spec:
  type: ClusterIP
  ports:
    - port: 25
      targetPort: 25
      protocol: TCP
      name: smtp

  selector:
    app.kubernetes.io/name: postfix
    app.kubernetes.io/instance: release-name
---
# Source: sdi-catalogue/templates/apache-loadbalancer.yaml
apiVersion: v1
kind: Service
metadata:
  name: apache
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: apache
  annotations:
    {}

spec:
  type: ClusterIP
  ports:
    - name: http
      port: 80
      targetPort: 80
      protocol: TCP
    - name: https
      port: 443
      targetPort: 443
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: apache
---
# Source: sdi-catalogue/templates/elasticsearch-es02-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: elasticsearch-es02
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: elasticsearch-es02
spec:
  type: ClusterIP
  ports:
  - name: elasticsearch
    port: 9200
    targetPort: 9200
  - name: cluster 
    port: 9300
    targetPort: 9300
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: elasticsearch-es02
---
# Source: sdi-catalogue/templates/elasticsearch-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: elasticsearch
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: elasticsearch
spec:
  type: ClusterIP
  ports:
  - name: elasticsearch
    port: 9200
    targetPort: 9200
  - name: cluster 
    port: 9300
    targetPort: 9300
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: elasticsearch
---
# Source: sdi-catalogue/templates/gn46-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: gn46
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: gn46
spec:
  type: ClusterIP
  ports:
  - port: 8080
    targetPort: 8080
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: gn46
---
# Source: sdi-catalogue/templates/gn5-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: gn5
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: gn5
spec:
  type: ClusterIP
  ports:
  - port: 8080
    targetPort: 8080
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: gn5
---
# Source: sdi-catalogue/templates/kibana-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: kibana
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: kibana
spec:
  type: ClusterIP
  ports:
  - name: kibana
    port: 5601
    targetPort: 5601
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: kibana
---
# Source: sdi-catalogue/templates/nextcloud-db-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: nextcloud-db
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: nextcloud-db
spec:
  type: ClusterIP
  ports:
  - name: mysql
    port: 3306
    targetPort: 3306
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: nextcloud-db
---
# Source: sdi-catalogue/templates/nextcloud-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: nextcloud
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: nextcloud
spec:
  type: ClusterIP
  ports:
  - name: "http"
    port: 80
    targetPort: 80
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: nextcloud
---
# Source: sdi-catalogue/templates/ogcapi-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: ogcapi
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: ogcapi
spec:
  type: ClusterIP
  ports:
  - name: ogcapi
    port: 8080
    targetPort: 8080
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: ogcapi
---
# Source: sdi-catalogue/templates/postgres-geonetwork-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: postgres-geonetwork
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: postgres-geonetwork
spec:
  type: ClusterIP
  ports:
  - name: postgres
    port: 5432
    targetPort: 5432
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: postgres-geonetwork
---
# Source: sdi-catalogue/templates/samba-http-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: samba
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: samba
  annotations:
    {}

spec:
  type: ClusterIP
  ports:
  - name: http
    port: 80
    targetPort: 80
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: samba
---
# Source: sdi-catalogue/templates/samba-loadbalancer.yaml
apiVersion: v1
kind: Service
metadata:
  name: samba-ldap
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: samba-ldap
  annotations:
    {}

spec:
  type: ClusterIP
  ports:
  - name: netbios
    port: 139
    targetPort: 139
  - name: "ds"
    port: 445
    targetPort: 445
  - name: "ldap"
    port: 389
    targetPort: 389
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: samba
---
# Source: sdi-catalogue/templates/validator-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: validator
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: validator

spec:
  type: ClusterIP
  ports:
  - name: "8080"
    port: 8080
    targetPort: 8080
  selector:
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    component: validator
---
# Source: sdi-catalogue/charts/postfix/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: postfix
  labels:
    helm.sh/chart: postfix-3.2.0
    app.kubernetes.io/name: postfix
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "3.5-1.2"
    app.kubernetes.io/managed-by: Helm

spec:
  replicas: 1
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1

  selector:
    matchLabels:
      app.kubernetes.io/name: postfix
      app.kubernetes.io/instance: release-name
  template:
    metadata:
      labels:
        app.kubernetes.io/name: postfix
        app.kubernetes.io/instance: release-name
    spec:
      serviceAccountName: default
      securityContext:
        {}

      containers:
      - name: postfix
        image: "eeacms/postfix:3.5-1.2"

        ports:
        - containerPort: 25
          protocol: TCP
          name: smtp
        - containerPort: 80
          protocol: TCP
          name: http

        env:
        - name: TZ
          value: "Europe/Copenhagen"
        - name: MTP_HOST
          value: sdi.eea.europa.eu
        - name: MTP_PASS
          value: ''
        - name: MTP_PORT
          value: ""
        - name: MTP_RELAY
          value: 
        - name: MTP_USER
          value: 
        resources:
          limits:
            memory: 128Mi
          requests:
            memory: 128Mi
        securityContext:
          {}
        livenessProbe:
          failureThreshold: 3
          initialDelaySeconds: 20
          periodSeconds: 20
          successThreshold: 1
          tcpSocket:
            port: 25
          timeoutSeconds: 3
        startupProbe:
          failureThreshold: 15
          initialDelaySeconds: 15
          periodSeconds: 5
          successThreshold: 1
          tcpSocket:
            port: 25
          timeoutSeconds: 3
      restartPolicy: Always
---
# Source: sdi-catalogue/templates/apache-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: apache
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: apache
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: apache
  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: apache
    spec:
      serviceAccountName: release-name-sdi-catalogue

      initContainers:
      # Set up ssl.conf and nc.conf
      - name: init-ssl-conf
        image: busybox:1.36
        command: ['sh', '-c', 'cp /mnt/ssl.conf /usr/local/apache2/conf/extra/ssl.conf && touch /usr/local/apache2/conf/extra/nc.conf']
        volumeMounts:
        - mountPath: /usr/local/apache2/conf/extra
          name: sdi-apache-configuration
        - mountPath: /mnt/ssl.conf
          name: sdi-apache-config
          readOnly: true
          subPath: ssl.conf

      containers:
      - name: apache
        image: eeacms/sdi-apache:1.0.15
        ports:
        - containerPort: 80
        - containerPort: 443
        env:
        - name: SERVERADMIN
          value: "helpdesk@eea.europa.eu"
        - name: SERVERNAME
          value: "apache"
        resources:
          limits:
            memory: 128Mi
          requests:
            memory: 64Mi
        volumeMounts:
        - mountPath: /usr/local/apache2/conf/extra
          name: sdi-apache-configuration

        - mountPath: /usr/local/apache2/htdocs
          name: sdi-apache-www
        - mountPath: /var/local/gis_sdi
          name: gis-sdi
          readOnly: true
        - mountPath: /var/log/apache/logs
          name: sdi-apache-log
        - mountPath: /ssl/server.key
          name: eea-certificate
          readOnly: true
          subPath: tls.key
        - mountPath: /ssl/server.crt
          name: eea-certificate
          readOnly: true
          subPath: tls.crt
        - mountPath: /ssl/ca-bundle.crt
          name: ca-certificates
          readOnly: true
          subPath: ca-bundle.crt
        - mountPath: /ssl/chain.crt
          name: ca-certificates
          readOnly: true
          subPath: chain.crt
      restartPolicy: Always
      volumes:
      - name: sdi-apache-configuration
        persistentVolumeClaim:
          claimName: sdi-apache-configuration
      - name: sdi-apache-www
        persistentVolumeClaim:
          claimName: sdi-apache-www
      - name: sdi-apache-log
        persistentVolumeClaim:
          claimName: sdi-apache-log
      - name: gis-sdi
        persistentVolumeClaim:
          claimName: gis-sdi
          readOnly: true

      - name: eea-certificate
        secret:
          defaultMode: 0444
          optional: false
          secretName: "dummy-certificate"
      - name: ca-certificates
        configMap:
          defaultMode: 0444
          optional: false
          name: release-name-cacrts
      - name: sdi-apache-config
        configMap:
          defaultMode: 0444
          optional: false
          name: sdi-apache-config
---
# Source: sdi-catalogue/templates/elasticsearch-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: elasticsearch
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: elasticsearch

spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: elasticsearch
  strategy:
    type: Recreate

  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: elasticsearch
    spec:
      serviceAccountName: release-name-sdi-catalogue
      initContainers:
      - name: sysctl-m
        image: rawmind/alpine-sysctl:0.2-1
        env:
        - name: SYSCTL_KEY
          value: vm.max_map_count
        - name: SYSCTL_VALUE
          value: "262144"
        resources: {}
        securityContext:
          privileged: true

      containers:
      - name: elasticsearch
        image: docker.elastic.co/elasticsearch/elasticsearch:8.14.3
        env:
        - name: ELASTIC_PASSWORD
          value: changeme
        - name: ES_JAVA_OPTS
          value: -Xms1G -Xmx1G
        - name: bootstrap.memory_lock
          value: "false"
        - name: cluster.initial_master_nodes
          value: elasticsearch,elasticsearch-es02
        - name: cluster.name
          value: sdi-es-cluster
        - name: discovery.seed_hosts
          value: elasticsearch-es02
        - name: node.name
          value: elasticsearch
        - name: xpack.security.enabled
          value: "false"
        - name: xpack.security.http.ssl.enabled
          value: "false"
        ports:
        - containerPort: 9200
        - containerPort: 9300
        resources:
          limits:
            memory: 3Gi
          requests:
            memory: 3Gi
        volumeMounts:
        - mountPath: /usr/share/elasticsearch/data
          name: sdi-esdata-node0
      restartPolicy: Always

      volumes:
      - name: sdi-esdata-node0
        persistentVolumeClaim:
          claimName: sdi-esdata-node0
---
# Source: sdi-catalogue/templates/elasticsearch-es02-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: elasticsearch-es02
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: elasticsearch-es02

spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: elasticsearch-es02
  strategy:
    type: Recreate

  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: elasticsearch-es02
    spec:
      serviceAccountName: release-name-sdi-catalogue
      initContainers:
      - name: sysctl-1
        image: rawmind/alpine-sysctl:0.2-1
        env:
        - name: SYSCTL_KEY
          value: vm.max_map_count
        - name: SYSCTL_VALUE
          value: "262144"
        resources: {}
        securityContext:
          privileged: true

      containers:
      - name: elasticsearch-es02
        image: docker.elastic.co/elasticsearch/elasticsearch:8.14.3
        env:
        - name: ELASTIC_PASSWORD
          value: changeme
        - name: ES_JAVA_OPTS
          value: -Xms1G -Xmx1G
        - name: bootstrap.memory_lock
          value: "false"
        - name: cluster.initial_master_nodes
          value: elasticsearch,elasticsearch-es02
        - name: cluster.name
          value: sdi-es-cluster
        - name: discovery.seed_hosts
          value: elasticsearch-es02
        - name: node.name
          value: elasticsearch-es02
        - name: xpack.security.enabled
          value: "false"
        - name: xpack.security.http.ssl.enabled
          value: "false"
        ports:
        - containerPort: 9200
        - containerPort: 9300
        resources:
          limits:
            memory: 3Gi
          requests:
            memory: 3Gi
        volumeMounts:
        - mountPath: /usr/share/elasticsearch/data
          name: sdi-esdata-node1
      restartPolicy: Always

      volumes:
      - name: sdi-esdata-node1
        persistentVolumeClaim:
          claimName: sdi-esdata-node1
---
# Source: sdi-catalogue/templates/gn46-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gn46
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: gn46

spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: gn46
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: gn46
    spec:
      serviceAccountName: release-name-sdi-catalogue
      containers:
      - name: gn46
        image: eeacms/eea-geonetwork:eea-4.9.x-1a3bd804
        env:
        - name: WEBAPP_CONTEXT_PATH
          value: /catalogue
        - name: geonetwork_dir
          value: /catalogue-data
        - name: CATALOGUE
          value: catalogue
        - name: JAVA_OPTIONS
          value: "-Djava.security.egd=file:/dev/./urandom -Djava.awt.headless=true -Xms512M -Xss512M -Xmx2G -XX:+UseConcMarkSweepGC -Dorg.eclipse.jetty.annotations.AnnotationParser.LEVEL=OFF"
        - name: GN_CONFIG_PROPERTIES
          value: "-Dgeonetwork.security.type=gn5 -Dgeonetwork.dir=/catalogue-data -Dgeonetwork.data.dir=/var/local/gis_sdi/cataloguestore/metadata_data -Dgeonetwork.db.type=postgres -Dgeonetwork.schema.dir=/opt/geonetwork/WEB-INF/data/config/schema_plugins -Dgeonetwork.formatter.dir=/catalogue-data/data/formatter -Dgeonetwork.indexConfig.dir=/opt/geonetwork/WEB-INF/data/config/index -Dgeonetwork.resources.dir=/catalogue-data/resources -Des.host=elasticsearch -Des.port=9200 -Des.protocol=http -Des.index.records=gn5-records -Des.url=http://elasticsearch:9200 -Dgeonetwork.ESFeaturesProxy.targetUri=http://elasticsearch:9200/gn5-features/{_} -Dkb.url=http://kibana:5601 -Dgeonetwork.HttpDashboardProxy.targetUri=http://kibana:5601"
        # To configure the database connection parameters fill the values in /catalogue-data/config/db.properties
        # To configure the LDAP connection options fill the values in /catalogue-data/config/security.properties

        # Liveness probe checks if the application is healthy and restarts the container if it fails
        livenessProbe:
          failureThreshold: 6
          httpGet:
            path: /catalogue/srv/eng/catalog.search
            port: 8080
            scheme: HTTP
          initialDelaySeconds: 90
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 10
        
        # Startup probe checks if the application has started successfully before running liveness/readiness probes
        startupProbe:
          failureThreshold: 30
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          tcpSocket:
            port: 8080
          timeoutSeconds: 5

        ports:
        - containerPort: 8080
        resources:
          null
        volumeMounts:
        - mountPath: /catalogue-data
          name: sdi-gn5-data
        - mountPath: /var/local/gis_sdi
          name: gis-sdi
          readOnly: false
        - mountPath: /catalogue-data/config/security.properties
          name: sdi-gn46-config
          readOnly: true
          subPath: security.properties
      restartPolicy: Always

      volumes:
      - name: sdi-gn5-data
        persistentVolumeClaim:
          claimName: sdi-gn5-data
      - name: gis-sdi
        persistentVolumeClaim:
          claimName: gis-sdi
          readOnly: false
      - name: sdi-gn46-config
        configMap:
          defaultMode: 0444
          optional: false
          name: sdi-gn46-config
---
# Source: sdi-catalogue/templates/gn5-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gn5
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: gn5

spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: gn5
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: gn5
    spec:
      serviceAccountName: release-name-sdi-catalogue
      containers:
      - name: gn5
        image: eeacms/eea-geonetwork5:1cc1b98e
        env:
        - name: SERVER_PORT
          value: "8080"
        - name: SPRING_DATASOURCE_URL
          value: jdbc:postgresql://postgres-geonetwork:5432/
        - name: SPRING_DATASOURCE_USERNAME
          value: 
        - name: SPRING_DATASOURCE_PASSWORD  
          value: 
        - name: JAVA_OPTS
          value: -Dfile.encoding=UTF-8
        - name: SPRING_CONFIG_ADDITIONAL_LOCATION
          value: optional:/catalogue-data/config/gn5-config.yaml

        # Liveness probe checks if the application is healthy and restarts the container if it fails
        livenessProbe:
          failureThreshold: 6
          httpGet:
            path: /catalogue/actuator/health/liveness
            port: 8080
            scheme: HTTP
          initialDelaySeconds: 90
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 10
        
        # Startup probe checks if the application has started successfully before running liveness/readiness probes
        startupProbe:
          failureThreshold: 30
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          tcpSocket:
            port: 8080
          timeoutSeconds: 5


        ports:
        - containerPort: 8080
        resources:
          limits:
            memory: 4Gi
          requests:
            memory: 2Gi
        volumeMounts:
        - mountPath: /catalogue-data
          name: sdi-gn5-data
        - mountPath: /var/local/gis_sdi
          name: gis-sdi
          readOnly: false
        - mountPath: /catalogue-data/config/gn5-config.yaml
          name: sdi-gn5-config
          readOnly: true
          subPath: gn5-config.yaml
      restartPolicy: Always

      volumes:
      - name: sdi-gn5-data
        persistentVolumeClaim:
          claimName: sdi-gn5-data
      - name: gis-sdi
        persistentVolumeClaim:
          claimName: gis-sdi
          readOnly: false
      - name: sdi-gn5-config
        configMap:
          defaultMode: 0444
          optional: false
          name: sdi-gn5-config
---
# Source: sdi-catalogue/templates/kibana-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kibana
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: kibana

spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: kibana
  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: kibana
    spec:
      serviceAccountName: release-name-sdi-catalogue
      containers:
      - name: kibana
        image: docker.elastic.co/kibana/kibana:8.14.3
        env:
        - name: ELASTICSEARCH_URL
          value: http://elasticsearch:9200/
        - name: SERVER_BASEPATH
          value: /catalogue/dashboards
        - name: SERVER_MAXPAYLOADBYTES
          value: "1048576000"
        - name: SERVER_NAME
          value: kibana
        - name: SERVER_REWRITEBASEPATH
          value: "false"
        - name: XPACK_MONITORING_UI_CONTAINER_ELASTICSEARCH_ENABLED
          value: "true"
        - name: CSP_STRICT
          value: "false" 
        resources:
          {}
        ports:
        - containerPort: 5601

      restartPolicy: Always
---
# Source: sdi-catalogue/templates/nextcloud-cron-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nextcloud-cron
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: nextcloud-cron

spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: nextcloud-cron
  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: nextcloud-cron
    spec:
      serviceAccountName: release-name-sdi-catalogue
      initContainers:
        - args:
            - >-
              ln -sf /etc/nextcloud/config/config.php /var/www/html/config/k8s.config.php
          command:
            - /bin/sh
            - '-c'
          image: busybox
          imagePullPolicy: Always
          name: symlink-k8s-config
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /etc/nextcloud/config
              name: nextcloud-config
              readOnly: true
            - mountPath: /var/www/html
              name: sdi-nextcloud-app
      containers:
      - name: nextcloud-cron
        image: eeacms/nextcloud:30.0.2-apache
        command:
        - /cron.sh
        env:
        - name: MYSQL_DATABASE
          value: ncdb
        - name: MYSQL_PASSWORD
          value: 
        - name: MYSQL_USER
          value: 
        - name: NEXTCLOUD_ADMIN_PASSWORD
          value: 
        - name: NEXTCLOUD_ADMIN_USER
          value: 
        - name: TZ
          value: Europe/Copenhagen
        resources:
          limits:
            memory: 2Gi
          requests:
            memory: 2Gi
        tty: true
        volumeMounts:
        - mountPath: /var/www/html
          name: sdi-nextcloud-app
        - mountPath: /etc/nextcloud/config
          name: nextcloud-config
          readOnly: true
        - mountPath: /var/local/gis_sdi
          name: gis-sdi
        - mountPath: /usr/local/apache2/htdocs
          name: sdi-apache-www

      restartPolicy: Always

      volumes:
      - name: sdi-nextcloud-app
        persistentVolumeClaim:
          claimName: sdi-nextcloud-app
      - name: gis-sdi
        persistentVolumeClaim:
          claimName: gis-sdi
      - name: sdi-apache-www
        persistentVolumeClaim:
          claimName: sdi-apache-www
      - name: nextcloud-config
        configMap:
          defaultMode: 0444
          optional: false
          name: nextcloud-config
---
# Source: sdi-catalogue/templates/nextcloud-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nextcloud
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: nextcloud

spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: nextcloud
  strategy:
    type: Recreate

  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: nextcloud
    spec:
      serviceAccountName: release-name-sdi-catalogue
      initContainers:
        - args:
            - >-
              ln -sf /etc/nextcloud/config/config.php /var/www/html/config/k8s.config.php
          command:
            - /bin/sh
            - '-c'
          image: busybox
          imagePullPolicy: Always
          name: symlink-k8s-config
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /etc/nextcloud/config
              name: nextcloud-config
              readOnly: true
            - mountPath: /var/www/html
              name: sdi-nextcloud-app
      containers:
      - name: nextcloud
        image: eeacms/nextcloud:30.0.2-apache
        env:
        - name: MYSQL_DATABASE
          value: ncdb
        - name: MYSQL_PASSWORD
          value: 
        - name: MYSQL_USER
          value: 
        - name: NEXTCLOUD_ADMIN_PASSWORD
          value: 
        - name: NEXTCLOUD_ADMIN_USER
          value: 
        - name: TRUSTED_PROXIES
          value: 10.0.0.1/8 gethostbyname('apache')
        - name: FORWARDED_FOR_HEADERS
          value: HTTP_X_FORWARDED HTTP_FORWARDED HTTP_X_REAL_IP
        ports:
        - containerPort: 80
        
        readinessProbe:
          httpGet:
            path: /status.php
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 60
          timeoutSeconds: 5
          failureThreshold: 3

        livenessProbe:
          httpGet:
            path: /status.php
            port: 80
          initialDelaySeconds: 30
          periodSeconds: 60
          timeoutSeconds: 5
          failureThreshold: 5

        startupProbe:
          httpGet:
            path: /status.php
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 18   # ~3 minutes grace time

        resources:
          {}
        tty: true
        volumeMounts:
        - mountPath: /var/www/html
          name: sdi-nextcloud-app
        - mountPath: /etc/nextcloud/config
          name: nextcloud-config
          readOnly: true
        - mountPath: /var/local/gis_sdi
          name: gis-sdi
        - mountPath: /usr/local/apache2/htdocs
          name: sdi-apache-www
      restartPolicy: Always

      volumes:
      - name: sdi-nextcloud-app
        persistentVolumeClaim:
          claimName: sdi-nextcloud-app
      - name: gis-sdi
        persistentVolumeClaim:
          claimName: gis-sdi
      - name: sdi-apache-www
        persistentVolumeClaim:
          claimName: sdi-apache-www
      - name: nextcloud-config
        configMap:
          defaultMode: 0444
          optional: false
          name: nextcloud-config
---
# Source: sdi-catalogue/templates/ogcapi-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ogcapi
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: ogcapi

spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: ogcapi
  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: ogcapi
    spec:
      serviceAccountName: release-name-sdi-catalogue

      hostname: ogcapi

      containers:
      - name: ogcapi
        image: geonetwork/gn-cloud-ogc-api-records-service:4.4.3-0
        ports:
        - containerPort: 8080
        env:
        - name: JAVA_OPTS
          value: -Dfile.encoding=UTF-8
        - name: SPRING_CONFIG_LOCATION
          value: /ogcapiconfig/
        - name: SPRING_PROFILES_ACTIVE
          value: standalone
        resources:
          {}

        livenessProbe:
          tcpSocket:
            port: 8080
          initialDelaySeconds: 15
          periodSeconds: 20

        volumeMounts:
        - mountPath: /ogcapiconfig
          name: sdi-ogcapi-config

      restartPolicy: Always

      volumes:
      - name: sdi-ogcapi-config
        configMap:
          name: sdi-ogcapi-config
---
# Source: sdi-catalogue/templates/validator-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: validator
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: validator

spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: validator
  strategy:
    type: Recreate

  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: validator
    spec:
      serviceAccountName: release-name-sdi-catalogue
      containers:
      - name: validator
        image: ghcr.io/inspire-mif/helpdesk-validator/inspire-validator:2025.1.1
        ports:
        - containerPort: 8080
        - containerPort: 8090
        resources:
          {}
        securityContext:
          privileged: true
        volumeMounts:
        - mountPath: /etf
          name: sdi-validator
        - mountPath: /etc/network/interfaces
          name: validator-config
          subPath: interfaces
        
        startupProbe:
          httpGet:
            path: /validator/v2/status
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 30  # allows up to 5 minutes for startup

        readinessProbe:
          httpGet:
            path: /validator/v2/status
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 30
          timeoutSeconds: 10
          failureThreshold: 3

        livenessProbe:
          httpGet:
            path: /validator/v2/status
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 60
          timeoutSeconds: 15
          failureThreshold: 5

      restartPolicy: Always

      volumes:
      - name: sdi-validator
        persistentVolumeClaim:
          claimName: sdi-validator
      - name: validator-config
        configMap:
          defaultMode: 0644
          optional: false
          name: validator-config
          items:
            - key: interfaces
              path: interfaces
---
# Source: sdi-catalogue/templates/nextcloud-db-stateful.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: nextcloud-db
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: nextcloud-db

spec:
  replicas: 1
  serviceName: release-name-ncdb
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: nextcloud-db

  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: nextcloud-db
    spec:
      terminationGracePeriodSeconds: 10
      serviceAccountName: release-name-sdi-catalogue

      containers:
      - name: nextcloud-db
        image: mariadb:10.11
        env:
        - name: MYSQL_DATABASE
          value: ncdb
        - name: MYSQL_PASSWORD
          value: 
        - name: MYSQL_ROOT_PASSWORD
          value: 
        - name: MYSQL_USER
          value: 
        resources:
          limits:
            memory: 5Gi
          requests:
            memory: 5Gi
        volumeMounts:
        - mountPath: /var/lib/mysql
          name: sdi-nextcloud-db

        livenessProbe:
          tcpSocket:
            port: 3306
          initialDelaySeconds: 15
          periodSeconds: 20

      restartPolicy: Always

  volumeClaimTemplates:
  - metadata:
      name: sdi-nextcloud-db
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: "4Gi"
---
# Source: sdi-catalogue/templates/postgres-geonetwork-stateful.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres-geonetwork
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: postgres-geonetwork

spec:
  replicas: 1
  serviceName: release-name-pggn
  selector:
    matchLabels:
      app.kubernetes.io/name: sdi-catalogue
      app.kubernetes.io/instance: release-name
      component: postgres-geonetwork

  template:
    metadata:
      labels:
        app.kubernetes.io/name: sdi-catalogue
        app.kubernetes.io/instance: release-name
        component: postgres-geonetwork
    spec:
      terminationGracePeriodSeconds: 10
      serviceAccountName: release-name-sdi-catalogue

      containers:
      - name: postgres-geonetwork
        image: postgres:13.1
        env:
        - name: POSTGRES_PASSWORD
          value: 
        - name: POSTGRES_DB
          value: geonetwork_sdi
        - name: POSTGRES_USER
          value: geonetwork
        - name: PSQL_PASSWORD
          value: 
        ports:
        - containerPort: 5432
          protocol: TCP
        resources:
          limits:
            cpu: "2"
            memory: 4Gi
          requests:
            cpu: "1"
            memory: 2Gi
        volumeMounts:
        - mountPath: /var/lib/postgresql/data
          name: sdi-geonetwork-postgres

        - mountPath: /ssl/server.key
          name: eea-certificate
          readOnly: true
          subPath: tls.key
        - mountPath: /ssl/server.crt
          name: eea-certificate
          readOnly: true
          subPath: tls.crt
        - mountPath: /ssl/ca-bundle.crt
          name: ca-certificates
          readOnly: true
          subPath: ca-bundle.crt

        livenessProbe:
          tcpSocket:
            port: 5432
          initialDelaySeconds: 15
          periodSeconds: 20

      restartPolicy: Always
      volumes:
      - name: eea-certificate
        secret:
          defaultMode: 0444
          optional: false
          secretName: "dummy-certificate"
      - name: ca-certificates
        configMap:
          defaultMode: 0444
          optional: false
          name: release-name-cacrts

  volumeClaimTemplates:
  - metadata:
      name: sdi-geonetwork-postgres
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: "4Gi"
---
# Source: sdi-catalogue/charts/postfix/templates/ingress-netsecpol.yaml
# Allow NGINX to contact the mailtrap service.
#
---
# Source: sdi-catalogue/templates/tests/test-apache.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "test-apache"
  namespace: test-gn
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: test
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['-S', '-O', '/dev/null', '--no-check-certificate', '--header', 'Host: apache', 'https://apache/']
  restartPolicy: Never
---
# Source: sdi-catalogue/templates/tests/test-dashboard.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "test-dashboard"
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: test
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['-S', 'http://kibana:5601/s/catalogue-monitor/api/status']
  restartPolicy: Never
---
# Source: sdi-catalogue/templates/tests/test-nextcloud-db.yaml
apiVersion: v1
kind: Pod
metadata:
  name: test-nextcloud-db
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: test
  annotations:
    "helm.sh/hook": test
#   "helm.sh/hook-delete-policy": "hook-succeeded"
spec:
  containers:
    - name: mariadb-test
      image: mariadb:10.5
      command: ['mysql']
      args:
      - --host=nextcloud-db
      - --user=
      - --password=
      - --execute
      - show tables
      - ncdb
  restartPolicy: Never
---
# Source: sdi-catalogue/templates/tests/test-nextcloud.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "test-nextcloud"
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: test
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['-S', '-O', '/dev/null', 'http://nextcloud/index.html']
  restartPolicy: Never
---
# Source: sdi-catalogue/templates/tests/test-samba.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "test-samba"
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: test
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['-S', '-O', '/dev/null', 'http://samba/']
  restartPolicy: Never
---
# Source: sdi-catalogue/templates/tests/test-swagger.yaml
apiVersion: v1
kind: Pod
metadata:
  name: test-swagger
  namespace: test-gn
  labels:
    helm.sh/chart: sdi-catalogue-0.8.38
    app.kubernetes.io/name: sdi-catalogue
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    component: test
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": "hook-succeeded"
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args:
      - -S
      - http://public-catalogue:8080/catalogue/doc/api/index.html
  restartPolicy: Never
